<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>27 Technical Book Verifier</title>

<style>
body{font-family:system-ui;margin:10px}
button{padding:6px 10px;margin:2px}
table{border-collapse:collapse;width:100%}
th,td{border:1px solid #ccc;padding:4px;font-size:12px}
.pass{color:green}
.x{color:red}
</style>
</head>

<body>

<h2>27번 도구 – 엑셀 업로드</h2>

<input type="file" id="file"/>
<button onclick="upload()">업로드(전체 교체)</button>

<table id="tbl">
<thead>
<tr>
<th>Publisher</th>
<th>Title</th>
<th>ISBN</th>
<th>Price</th>
<th>Pub Date</th>
<th>Pages</th>
</tr>
</thead>
<tbody></tbody>
</table>

<!-- 핵심: CDN XLSX -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<script>
function detectPublisher(name){
 name=name.toLowerCase()
 if(name.includes("springer"))return"Springer"
 if(name.includes("elsevier"))return"Elsevier"
 if(name.includes("wiley"))return"Wiley"
 return"UNKNOWN"
}

function excelDate(v){
 if(typeof v==="number"){
  const d=new Date((v-25569)*86400*1000)
  return d.toISOString().slice(0,10)
 }
 return v||""
}

async function upload(){
 const f=document.getElementById("file").files[0]
 if(!f)return alert("파일 선택")
 const data=await f.arrayBuffer()
 const wb=XLSX.read(data)
 const ws=wb.Sheets[wb.SheetNames[0]]
 const json=XLSX.utils.sheet_to_json(ws,{defval:""})
 const pub=detectPublisher(f.name)
 const tb=document.querySelector("#tbl tbody")
 tb.innerHTML=""
 json.forEach(r=>{
  const tr=document.createElement("tr")
  tr.innerHTML=`
  <td>${pub}</td>
  <td>${r.Title||""}</td>
  <td>${r.ISBN||r.ISBN13||""}</td>
  <td>${r["List Price (USD)"]||r["Price EUR"]||r["US$"]||""}</td>
  <td>${excelDate(r["Pub date"]||r["Pub Date"]||r["Actual Publishing Date"])}</td>
  <td>${r["No of Pages"]||r.Pages||r["No of Arabic Pages"]||""}</td>`
  tb.appendChild(tr)
 })
}
</script>

</body>
</html>
