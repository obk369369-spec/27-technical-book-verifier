<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>27번 도구 PASS/X</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<style>
  body { font-family: Arial; padding:20px; }
  table { border-collapse: collapse; width:100%; margin-top:20px; }
  th, td { border:1px solid #999; padding:8px; text-align:left; }
  .pass { background:#ccffcc; }
  .fail { background:#ffcccc; }
  button { padding:4px 8px; }
</style>
</head>
<body>

<h2>27번 도구 – 엑셀 업로드</h2>
<input type="file" id="excelFile" accept=".xlsx,.xls" />

<table id="resultTable">
  <thead>
    <tr>
      <th>Title</th>
      <th>ISBN</th>
      <th>ANCHOR</th>
      <th>PASS</th>
      <th>X</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const input = document.getElementById('excelFile');
const tableBody = document.querySelector('#resultTable tbody');

input.addEventListener('change', handleFile);

function handleFile(e) {
  const file = e.target.files[0];
  if(!file) return;

  const reader = new FileReader();

  reader.onload = function(ev) {
    const data = new Uint8Array(ev.target.result);
    const workbook = XLSX.read(data, { type: 'array' });

    const sheetName = workbook.SheetNames[0];
    const sheet = workbook.Sheets[sheetName];
    const rows = XLSX.utils.sheet_to_json(sheet);

    tableBody.innerHTML = '';

    rows.forEach((row, idx) => {
      const tr = document.createElement('tr');

      const title = row.Title || row.title || '';
      const isbn = row.ISBN || row.isbn || '';

      // ANCHOR = 파일명 + 행번호
      const anchor = file.name + ' / row:' + (idx + 2);

      tr.innerHTML = `
        <td>${title}</td>
        <td>${isbn}</td>
        <td>${anchor}</td>
        <td><button onclick="markPass(this)">PASS</button></td>
        <td><button onclick="markX(this)">X</button></td>
      `;

      tableBody.appendChild(tr);
    });
  };

  reader.readAsArrayBuffer(file);
}

function markPass(btn){
  const tr = btn.closest('tr');
  tr.classList.remove('fail');
  tr.classList.add('pass');
}

function markX(btn){
  const tr = btn.closest('tr');
  tr.classList.remove('pass');
  tr.classList.add('fail');
}
</script>

</body>
</html>
