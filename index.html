<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>CSV 검증 도구</title>
<style>
body { font-family: sans-serif; margin:0; background:#ffffff; color:#111; }
header { position:sticky; top:0; background:#fff; z-index:10; border-bottom:1px solid #ccc; padding:8px;}
button { margin:2px; padding:6px 10px; }
table { border-collapse:collapse; width:100%; }
th, td { border:1px solid #ccc; padding:4px; font-size:13px; }
th { position:sticky; top:48px; background:#f5f5f5; z-index:5;}
#log { position:fixed; bottom:0; left:0; right:0; height:120px; background:#fafafa; border-top:1px solid #ccc; overflow:auto; font-size:12px;}
.popup { position:fixed; top:80px; left:50%; transform:translateX(-50%); width:80%; background:#fff; border:1px solid #333; padding:10px; display:none; max-height:60%; overflow:auto;}
.rowwarn { background:#fff4e5;}
.rowx { background:#ffe5e5;}
</style>
</head>
<body>

<header>
<button onclick="showX()">X 리스트</button>
<button onclick="showWarn()">WARN 리스트</button>
<button onclick="autoFix()">자동수정</button>
</header>

<div style="padding:10px; margin-bottom:140px;">
<table id="grid">
<thead>
<tr>
<th>Publisher</th><th>Title</th><th>KOR_TITLE</th><th>KOR_SUBTITLE</th><th>ISBN</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>

<div id="log"></div>

<div id="popupX" class="popup">
<h3>X 리스트</h3>
<div id="xContent"></div>
<button onclick="copyX()">복사</button>
<button onclick="closePop()">닫기</button>
</div>

<div id="popupWarn" class="popup">
<h3>WARN 리스트</h3>
<div id="wContent"></div>
<button onclick="copyWarn()">복사</button>
<button onclick="closePop()">닫기</button>
</div>

<script>
let data=[
{Publisher:"Wiley",Title:"Banking",KOR_TITLE:"",KOR_SUBTITLE:"",ISBN:"9781120000000"},
{Publisher:"Wiley",Title:"System",KOR_TITLE:"",KOR_SUBTITLE:"",ISBN:""}
];

function render(){
const tb=document.getElementById("tbody");
tb.innerHTML="";
data.forEach((r,i)=>{
let tr=document.createElement("tr");
let x=isX(r); let w=isWarn(r);
if(x) tr.className="rowx"; else if(w) tr.className="rowwarn";
tr.innerHTML=`<td>${r.Publisher}</td><td>${r.Title}</td><td>${r.KOR_TITLE}</td><td>${r.KOR_SUBTITLE}</td><td>${r.ISBN}</td>`;
tb.appendChild(tr);
});
}

function isX(r){ return !r.ISBN; }
function isWarn(r){ return !r.KOR_TITLE || !r.KOR_SUBTITLE; }

function showX(){
let out="";
data.forEach((r,i)=>{ if(isX(r)) out+=`#${i} ISBN 비어있음\n`; });
document.getElementById("xContent").innerText= out||"없음";
document.getElementById("popupX").style.display="block";
}

function showWarn(){
let out="";
data.forEach((r,i)=>{ if(isWarn(r)) out+=`#${i} 한글 제목 비어있음\n`; });
document.getElementById("wContent").innerText= out||"없음";
document.getElementById("popupWarn").style.display="block";
}

function closePop(){ popupX.style.display="none"; popupWarn.style.display="none"; }

function copyX(){ navigator.clipboard.writeText(xContent.innerText); }
function copyWarn(){ navigator.clipboard.writeText(wContent.innerText); }

function autoFix(){
data.forEach(r=>{
if(!r.KOR_TITLE) r.KOR_TITLE="(자동)";
if(!r.KOR_SUBTITLE) r.KOR_SUBTITLE="(자동)";
});
log("자동수정 완료");
render();
}

function log(t){
logDiv=document.getElementById("log");
logDiv.innerText+=t+"\n";
logDiv.scrollTop=logDiv.scrollHeight;
}

render();
</script>
</body>
</html>
